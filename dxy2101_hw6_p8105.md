dxy2101_hw6_p8105
================
Daisy Yan
2022-12-03

``` r
library(tidyverse)
library(ggplot2)
```

## Problem 2

Load and prepare homicide data.

``` r
# Load data
url = 'https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv'

homicide_data = read_csv(url)

# Create new variables and clean
homicide_data =
  homicide_data %>%
  mutate(city_state = str_c(city, state, sep = ", "),
         status = case_when(
           disposition == "Closed without arrest" ~ "unsolved",
           disposition == "Open/No arrest" ~ "unsolved",
           disposition == "Closed by arrest" ~ "solved"
         )) %>%
  select(-city, -state, -disposition) %>%
  relocate(city_state, .before = lat) %>%
  subset(city_state != "Dallas, TX" & city_state != "Phoenix, AZ"
         & city_state != "Kansas City, MO" & city_state != "Tulsa, AL") %>%
  filter(victim_race == "White" | victim_race == "Black") %>%
  mutate(victim_age = as.numeric(victim_age))
```

For the city of Baltimore, MD, use the glm function to fit a logistic
regression with resolved vs unresolved as the outcome and victim age,
sex and race as predictors.

``` r
# Filter for Baltimore, MD
baltimore_df =
  homicide_data %>%
  filter(city_state == "Baltimore, MD") %>%
  mutate(
    resolved = as.numeric(status == "solved"),
    victim_race = fct_relevel(victim_race, "White")) %>% 
  select(resolved, victim_age, victim_race, victim_sex)

# Fit logistic regression
fit_logistic = 
  baltimore_df %>% 
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 

# Obtain estimate and CI of OR
fit_logistic %>% 
  broom::tidy() %>% 
  mutate(
    OR = exp(estimate),
    low.lim = OR - (1.96*std.error),
    up.lim = OR + (1.96*std.error)) %>%
  select(term, log_OR = estimate, OR, low.lim, up.lim, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | low.lim | up.lim | p.value |
|:-----------------|-------:|------:|--------:|-------:|--------:|
| (Intercept)      |  1.152 | 3.164 |   2.700 |  3.628 |   0.000 |
| victim_age       | -0.007 | 0.993 |   0.987 |  1.000 |   0.043 |
| victim_raceBlack | -0.842 | 0.431 |   0.089 |  0.773 |   0.000 |
| victim_sexMale   | -0.854 | 0.426 |   0.155 |  0.696 |   0.000 |

The odds ratio for solving homicides comparing male victims to female
victims, controlling for age and race, is 0.426 (95% CI: 0.155, 0.696).

Now, run glm for each of the cities in your dataset, and extract the
adjusted odds ratio (and CI) for solving homicides comparing male
victims to female victims.
